

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Localization (L10n) &mdash; playdoh v1.0 documentation</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="playdoh v1.0 documentation" href="../" />
    <link rel="next" title="pip and friends: Packaging" href="../packages/" />
    <link rel="prev" title="Database Migrations" href="../migrations/" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../packages/" title="pip and friends: Packaging"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../migrations/" title="Database Migrations"
             accesskey="P">previous</a> |</li>
        <li><a href="../">playdoh v1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="localization-l10n">
<h1>Localization (L10n)<a class="headerlink" href="#localization-l10n" title="Permalink to this headline">¶</a></h1>
<p>So you&#8217;d like to localize your webapp. <strong>Congratulations!</strong></p>
<p>Playdoh comes with all of the libraries and tools you need in the dev and
production requirements.</p>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>The one set of low level tools not provided is gettext.</p>
<div class="highlight-python"><pre>aptitude install gettext
# or
brew install gettext</pre>
</div>
</div>
<div class="section" id="environment-setup">
<h2>Environment Setup<a class="headerlink" href="#environment-setup" title="Permalink to this headline">¶</a></h2>
<p>Your top level directory named locale should be an SVN repository. This is
because localizers are used to SVN and some tools like Pootle tie into it.
Developers who never deal with L10n do not need to worry about this kind of
setup. It&#8217;s often easier to have a L10n dev setup, which a cron job updates
the sources, updates the strings, and compiles the po files and lastly
commiting to SVN.</p>
</div>
<div class="section" id="initial-steps">
<h2>Initial Steps<a class="headerlink" href="#initial-steps" title="Permalink to this headline">¶</a></h2>
<p>To allow localizers to translate your app on localize.mozilla.org, your .po
files need to be in SVN. You want a checkout of your locale directory to live
inside the git checkout under <tt class="docutils literal"><span class="pre">locale</span></tt>.</p>
<p>The following steps will get you started:</p>
<ol class="arabic">
<li><p class="first">Create an SVN repository with locale-based directories and <tt class="docutils literal"><span class="pre">templates</span></tt>.
You need at least:</p>
<div class="highlight-python"><pre>./en_US
./en_US/LC_MESSAGES
./templates
./templates/LC_MESSAGES</pre>
</div>
</li>
<li><p class="first">Check out this SVN repository inside your project path:</p>
<div class="highlight-python"><pre>cd /my/playdoh/project/dir/
svn checkout https://svn.mozilla.org/projects/something/trunk/locale locale

## If you don't like svn, you may use git-svn too:
# git svn clone https://svn.mozilla.org/projects/something/trunk/locale locale</pre>
</div>
</li>
<li><p class="first">Now extract strings from your project:</p>
<div class="highlight-python"><pre>./manage.py extract
./manage.py verbatimize --rename
./manage.py merge</pre>
</div>
</li>
<li><p class="first">Commit it all.</p>
</li>
<li><p class="first">Build your .mo files and commit those as well:</p>
<div class="highlight-python"><pre>./bin/compile-mo.sh locale/
cd locale
git add .
git commit -m 'Built .mo files'</pre>
</div>
</li>
</ol>
</div>
<div class="section" id="extracting-strings">
<h2>Extracting Strings<a class="headerlink" href="#extracting-strings" title="Permalink to this headline">¶</a></h2>
<p>If you&#8217;ve developed a feature and changed or added strings, you need to extract
them and merge them into the existing .po files:</p>
<div class="highlight-python"><pre>./manage.py extract

./manage.py verbatimize --rename
# This will copy the POT files created in step 1 to templates/LC_MESSAGES.

./manage.py merge</pre>
</div>
<p>Optionally compile all .mo files:</p>
<div class="highlight-python"><pre>./bin/compile-mo.sh locale/</pre>
</div>
</div>
<div class="section" id="creating-new-locales">
<h2>Creating New Locales<a class="headerlink" href="#creating-new-locales" title="Permalink to this headline">¶</a></h2>
<p>Assuming you want to add &#8216;fr&#8217;:</p>
<ol class="arabic simple">
<li><tt class="docutils literal"><span class="pre">mkdir</span> <span class="pre">-p</span> <span class="pre">locale/fr/LC_MESSAGES</span></tt></li>
<li><tt class="docutils literal"><span class="pre">./manage.py</span> <span class="pre">merge</span></tt></li>
</ol>
<p>or</p>
<ol class="arabic simple">
<li><tt class="docutils literal"><span class="pre">msginit</span> <span class="pre">--no-translator</span> <span class="pre">-l</span> <span class="pre">fr</span> <span class="pre">-i</span> <span class="pre">templates/LC_MESSAGES/messages.pot</span> <span class="pre">-o</span> <span class="pre">fr/LC_MESSAGES/messages.po</span></tt></li>
<li>repeat for other POT files</li>
</ol>
</div>
<div class="section" id="advanced-steps">
<h2>Advanced Steps<a class="headerlink" href="#advanced-steps" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Some projects keep a copy of the SVN checkout in git. When doing that,
keep in mind that <tt class="docutils literal"><span class="pre">git</span> <span class="pre">svn</span> <span class="pre">dcommit</span></tt> will change the commit message,
thus changing the git commit ID. Therefore, always commit to SVN first,
then push to git, never vice-versa:</p>
<div class="highlight-python"><pre>cd locale/
# do something
git commit -am 'did something'
git svn dcommit &amp;&amp; git push origin HEAD</pre>
</div>
</li>
<li><p class="first">localize.mozilla.org does not automatically compile .mo files when a
localizer commits to SVN. Neither does it automate the push over to
git. There&#8217;s a handy little script called <tt class="docutils literal"><span class="pre">autol10n</span></tt> that you can
run as a cron job somewhere, which will:</p>
<ul class="simple">
<li>pick up changed .po files from SVN,</li>
<li>compile the .mo files,</li>
<li>then (if necessary) push everything over to git...</li>
<li>... and retag the git submodule to the latest revision.</li>
</ul>
<p>The script is available in playdoh under <tt class="docutils literal"><span class="pre">bin/autol10n.sh</span></tt>.</p>
</li>
</ol>
</div>
<div class="section" id="q-a">
<h2>Q&amp;A<a class="headerlink" href="#q-a" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><em>Why SVN?</em> Our localizers like to use either SVN or Verbatim.</li>
<li><em>Why a git repo to mirror an SVN repo?</em> This allows us to have an external
reference (&#8220;git submodule&#8221;) and deploy the app including its translations
easily.</li>
<li><em>How do I use gettext?</em> In templates we use <a class="reference external" href="http://jinja.pocoo.org/docs/templates/#i18n">jinja</a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Localization (L10n)</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#environment-setup">Environment Setup</a></li>
<li><a class="reference internal" href="#initial-steps">Initial Steps</a></li>
<li><a class="reference internal" href="#extracting-strings">Extracting Strings</a></li>
<li><a class="reference internal" href="#creating-new-locales">Creating New Locales</a></li>
<li><a class="reference internal" href="#advanced-steps">Advanced Steps</a></li>
<li><a class="reference internal" href="#q-a">Q&amp;A</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../migrations/"
                        title="previous chapter">Database Migrations</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../packages/"
                        title="next chapter">pip and friends: Packaging</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/l10n.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search/" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex/" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../packages/" title="pip and friends: Packaging"
             >next</a> |</li>
        <li class="right" >
          <a href="../migrations/" title="Database Migrations"
             >previous</a> |</li>
        <li><a href="../">playdoh v1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Mozilla.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>